(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"0rcz":function(e,t,a){var n={"./zh-cn":"EO8f","./zh-cn.js":"EO8f"};function o(e){var t=s(e);return a(t)}function s(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=s,e.exports=o,o.id="0rcz"},"7TMI":function(e,t,a){"use strict";a.r(t);var n=a("zAuD"),o=a.n(n),s=a("xwgP"),r=a.n(s),i=(a("SMEU"),a("xc0u")),c=(a("NWD0"),a("2L3m")),l=(a("4ADO"),a("wty1")),d=(a("6/yB"),a("SE39")),m=(a("iHEV"),a("oj+F"),a("iRon"),a("d+vH"),a("DbVt")),p=(a("26gd"),a("1GiV")),u=(a("EH+i"),a("VusA"),a("on7z")),h=a("i2du"),f=a.n(h),g=a("yq+b"),E=a.n(g),w=a("tcMs"),b=a.n(w),v=a("wPJI"),C=a.n(v),y=f.a.getCookie;class N extends r.a.Component{constructor(e){super(e),this.handleAutoSave=(()=>{var e=this.props.match.params.iscore,t=this.editorNode?this.editorNode.getAllData():{base:0},a=document.getElementsByClassName("ws-warning")&&document.getElementsByClassName("ws-warning").length>0;2!==Number(e)&&t&&!a&&Number(t.base)>1&&(p.a.warn("即将离开页面，自动保存当前用例。"),this.updateCase())}),this.getRequirementsById=(e=>{}),this.getCaseById=(()=>{var e="".concat(this.props.doneApiPrefix,"/case/getCaseInfo");Object(u.a)(e,{method:"GET",params:{id:this.props.match.params.caseId}}).then(e=>{200==e.code?this.setState({casedetail:e.data},()=>{this.state.casedetail.requirementId&&this.getRequirementsById(this.state.casedetail.requirementId)}):(p.a.error(e.msg),this.props.history.push("/case/caseList/1"))})}),this.getContentById=(()=>{var e="".concat(this.props.doneApiPrefix,"/record/getRecordInfo");Object(u.a)(e,{method:"GET",params:{id:this.props.match.params.itemid}}).then(e=>{200==e.code?this.setState({recordDetail:e.data}):p.a.error(e.msg)})}),this.updateCase=(()=>{var e="undefined"==this.props.match.params.itemid?void 0:this.props.match.params.itemid,t={id:this.props.match.params.caseId,title:"更新内容，实际不会保存title",recordId:e,modifier:y("username"),caseContent:JSON.stringify(this.editorNode.getAllData())},a="".concat(this.props.doneApiPrefix,"/case/update");Object(u.a)(a,{method:"POST",body:t}).then(e=>{200==e.code?p.a.success("保存内容成功"):p.a.error(e.msg)})}),this.clearRecord=(()=>{var e={id:this.props.match.params.itemid,modifier:y("username")},t="".concat(this.props.doneApiPrefix,"/record/clear");Object(u.a)(t,{method:"POST",body:e}).then(e=>{200==e.code?(p.a.success("清除执行记录成功"),this.editorNode.setEditerData(JSON.parse(e.data.caseContent))):p.a.error(e.msg)})}),this.state={modaltitle:"",visibleStatus:!1,visible:!1,title:"",caseContent:"",id:0,productId:0,recordDetail:null,casedetail:null,requirementObj:[]}}componentDidMount(){"3"===this.props.match.params.iscore?this.getContentById():this.getCaseById()}componentWillMount(){window.addEventListener("beforeunload",this.handleAutoSave)}componentWillUnmount(){window.removeEventListener("beforeunload",this.handleAutoSave),this.handleAutoSave()}render(){var e=this.props.match.params,t=e.iscore,a=e.caseId,n=e.itemid,o=y("username"),s=this.state,u=s.recordDetail,h=s.casedetail,f=!1,g=!1;return"0"===t||"1"===t?(f=!1,g=!1):(f=!0,g=!0),r.a.createElement("div",{style:{position:"relative",minHeight:"80vh"}},r.a.createElement(m.a,{style:{marginBottom:8,fontSize:12}},r.a.createElement(m.a.Item,null,r.a.createElement(b.a,{to:"/case/caseList/1"},h?"用例":"任务","管理")),r.a.createElement(m.a.Item,null,h?"用例":"任务","详情：",u?u.title:"",h?h.title:"")),r.a.createElement("div",{style:{padding:12,background:"#fff"}},u&&r.a.createElement(c.a,null,r.a.createElement(l.a,{span:6,className:"description-case elipsis-case"},r.a.createElement(d.a,{title:u.description,placement:"bottomLeft"},u.description)),r.a.createElement(l.a,{span:1}),r.a.createElement(l.a,{span:2,className:"font-size-12"},"通过率: ",u.passRate.toFixed(2)+"%"),r.a.createElement(l.a,{span:2,className:"font-size-12"}," ","已测: ",u.passCount+"/"+u.totalCount),r.a.createElement(l.a,{span:4,style:{textAlign:"center"},className:"progress"},r.a.createElement("div",null,r.a.createElement(d.a,{title:"通过:".concat(u.successCount," (").concat((u.successCount/u.totalCount*100).toFixed(2),"%)"),className:"font-size-12"},r.a.createElement("div",{className:"div-wrap",style:{width:"".concat(u.successCount/u.totalCount*100,"%"),backgroundColor:"#61C663"}},r.a.createElement("span",null)))||null,u.blockCount>0&&r.a.createElement(d.a,{title:"阻塞:".concat(u.blockCount," (").concat((u.blockCount/u.totalCount*100).toFixed(2),"%)"),className:"font-size-12"},r.a.createElement("div",{className:"div-wrap",style:{width:"".concat(u.blockCount/u.totalCount*100,"%"),backgroundColor:"#85A1D6"}},r.a.createElement("span",null)))||null,u.bugNum>0&&r.a.createElement(d.a,{title:"失败:".concat(u.bugNum," (").concat((u.bugNum/u.totalCount*100).toFixed(2),"%)")},r.a.createElement("div",{className:"div-wrap",style:{width:"".concat(u.bugNum/u.totalCount*100,"%"),backgroundColor:"#FF7575"}},r.a.createElement("span",null)))||null,u.totalCount-u.passCount>0&&r.a.createElement(d.a,{title:"未执行:".concat(u.totalCount-u.passCount," (").concat(((u.totalCount-u.passCount)/u.totalCount*100).toFixed(2),"%)")},r.a.createElement("div",{className:"div-wrap",style:{width:"".concat((u.totalCount-u.passCount)/u.totalCount*100,"%"),backgroundColor:"#EDF0FA"}},r.a.createElement("span",null)))||null)),r.a.createElement(l.a,{span:1}),r.a.createElement(l.a,{span:2,className:"font-size-12"},"计划周期:"),r.a.createElement(l.a,{span:4,className:"font-size-12"},u.expectStartTime?E()(u.expectStartTime).format("YYYY/MM/DD"):null,"-"," ",u.expectEndTime?E()(u.expectEndTime).format("YYYY/MM/DD"):null))||null,h&&r.a.createElement(c.a,null,r.a.createElement(l.a,{span:6,className:"description-case elipsis-case"},r.a.createElement(d.a,{title:h.description,placement:"topLeft"},h.description)),r.a.createElement(l.a,{span:1}),r.a.createElement(l.a,{span:2,className:"font-size-12"},"关联需求:"),r.a.createElement(l.a,{span:14,className:"font-size-12"},h?h.requirementId:""))||null,r.a.createElement("div",{style:{display:"inline-block",position:"fixed",bottom:"30px",right:"20px",zIndex:999}},2!=t&&r.a.createElement(i.a,{type:"primary",onClick:this.updateCase},"保存"),r.a.createElement("span",null,"    "),3==t&&r.a.createElement(i.a,{type:"primary",onClick:this.clearRecord},"清除执行记录")),r.a.createElement(C.a,{ref:e=>this.editorNode=e,tags:["前置条件","执行步骤","预期结果"],progressShow:g,readOnly:f,mediaShow:!g,editorStyle:{height:"calc(100vh - 100px)"},toolbar:{image:!0,theme:["classic-compact","fresh-blue","fresh-green-compat"],template:["default","right","fish-bone"],noteTemplate:"# test"},baseUrl:"",uploadUrl:"/api/file/uploadAttachment",wsUrl:"ws://".concat(window.location.host,"/api/case/").concat(a,"/").concat(n,"/").concat(t,"/").concat(o),onSave:2!==Number(t)?()=>{p.a.loading("保存中......",1),this.updateCase()}:null})))}}a("30w7");var x=f.a.getCookie;t.default=class extends r.a.Component{componentDidMount(){x("username")||(window.location.href="/login?jumpto=".concat(window.location.href))}render(){return x("username")?r.a.createElement("section",{style:{padding:24}},r.a.createElement(N,o()({},this.props,{type:"oe",baseUrl:"",kityApiPrefix:"KITY_dev",oeApiPrefix:"",doneApiPrefix:""}))):null}}},VusA:function(e,t,a){e.exports={progress:"progress","border-wrap":"border-wrap","div-wrap":"div-wrap","case-title":"case-title","description-case":"description-case","m-b-18":"m-b-18","font-size-12":"font-size-12","elipsis-case":"elipsis-case"}},i2du:function(e,t){t.getCookie=function(e){for(var t,a,n=e+"=",o=n.length,s=document.cookie.length,r=0,i=0;r<s;){if(i=r+o,document.cookie.substring(r,i)===n)return t=i,a=void 0,-1===(a=document.cookie.indexOf(";",t))&&(a=document.cookie.length),decodeURI(document.cookie.substring(t,a));if(0===(r=document.cookie.indexOf(" ",r)+1))break}return null}},"oj+F":function(e,t,a){},on7z:function(e,t,a){"use strict";a.d(t,"a",function(){return l});a("dmE+");var n=a("SseY"),o=a("mK77"),s=a.n(o),r=a("gq5N"),i=a.n(r);window.apiPrefix="/api",i.a.defaults.timeout=3e5,i.a.defaults.withCredentials=!0;var c={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",400:"发出的请求有错误，服务器没有进行新建或修改数据的操作。",401:"用户没有权限（令牌、用户名、密码错误）。",403:"用户得到授权，但是访问是被禁止的。",404:"发出的请求针对的是不存在的记录，服务器没有进行操作。",406:"请求的格式不可得。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器发生错误，请检查服务器。",502:"网关错误。",503:"服务不可用，服务器暂时过载或维护。",504:"网关超时。"};function l(e,t){var a={};if(a.method=void 0!==t?t.method:"get",t&&(t.body&&(a.data="string"==typeof t.body?JSON.parse(t.body):t.body),void 0!==t.params)){for(var o in e+="?",t.params)void 0!==t.params[o]&&""!==t.params[o]&&(e=e+o+"="+t.params[o]+"&");e=e.substring(0,e.length-1)}return i()(s()({url:e},a)).then(e=>{if(401===e.data.code||401===e.code){var t="".concat(e.data.data.login_url,"?app_id=").concat(e.data.data.app_id),a=encodeURIComponent(window.location.href),n="".concat(t,"&version=1.0&jumpto=").concat(a);return window.location.href=n,Promise.reject(new Error("服务不可用，请联系管理员"))}if(99993===e.data.code||99993===e.code){return window.location.href="/login",Promise.reject(new Error("服务不可用，请联系管理员"))}return s()({},e.data)}).catch(e=>{if(e.response){var t=e.response.status,a=c[t]||e.response.statusText;return n.a.error({message:"请求错误 ".concat(t),description:a}),{code:t,message:a}}})}i.a.interceptors.request.use(e=>(e.baseURL=window.apiPrefix,e),e=>Promise.reject(e)),i.a.interceptors.response.use(e=>e,e=>Promise.reject(e))}}]);